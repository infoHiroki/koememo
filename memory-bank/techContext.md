# 技術コンテキスト

## 開発環境

KoeMemoは以下の環境で開発されています：

- **プログラミング言語**: Python 3.8以上
- **主要OS**: macOS, Windows (クロスプラットフォーム対応)
- **開発ツール**: Visual Studio Code, Git
- **パッケージ管理**: pip

## 核となる技術

### 1. Faster Whisper

- **概要**: OpenAIのWhisperモデルの高速実装
- **特徴**: 
  - 原語Whisperより最大4倍高速
  - CTranslate2フレームワークによる最適化
  - CPU/GPUどちらでも動作可能
  - 様々なサイズのモデル（tiny, base, small, medium, large）
  - 多言語対応（特に日本語にも対応）
- **設定オプション**:
  - モデルサイズ (精度と速度のトレードオフ)
  - 計算タイプ (float32, float16, int8)
  - 言語指定 (ja, en, 等)

### 2. LLM API連携

- **対応プロバイダー**:
  - OpenAI (GPT-3.5/4シリーズ)
  - Anthropic (Claude 3シリーズ)
  - Google (Gemini Pro/Ultra)
- **API通信**:
  - RESTful API呼び出し
  - JSON形式のリクエスト/レスポンス
  - エラーハンドリングとリトライ機構
- **プロンプト管理**:
  - テンプレートベースのプロンプト
  - 文字起こしテキストの挿入

### 3. Watchdog

- **機能**: ファイルシステムイベント監視
- **イベントタイプ**: 作成、変更、削除、移動
- **実装**: ObserverパターンとFileSystemEventHandler
- **特徴**: 
  - 低リソース消費
  - クロスプラットフォーム対応
  - イベントフィルタリング機能

### 4. Tkinter

- **概要**: Pythonの標準GUIライブラリ
- **使用目的**: シンプルな設定画面の提供
- **コンポーネント**:
  - タブコントロール
  - フォーム要素（テキスト入力、ドロップダウン等）
  - ボタン、ラベル
  - スクロールテキスト（ログ表示用）

## 技術的制約

1. **処理性能制約**:
   - 文字起こし速度はハードウェア性能に依存
   - GPUがない環境では処理が遅くなる可能性
   - 長時間の音声ファイルは処理に時間がかかる

2. **API制約**:
   - LLMプロバイダーのAPI利用制限（レート制限）
   - API認証キーの必要性
   - API使用料金の発生

3. **依存関係**:
   - FFmpegのシステムレベルでのインストールが必要
   - ネットワーク接続が必要（初回モデルダウンロード、API通信）

## ファイル構成

```
koememo/
├── main.py        # メインサービス実装
│   ├── MediaFileHandler      # ファイル監視クラス
│   ├── load_whisper_model    # モデル読み込み関数
│   ├── transcribe_file       # 文字起こし関数
│   ├── call_llm_api          # LLM API呼び出し関数
│   ├── process_file_queue    # キュー処理関数
│   ├── start_file_watcher    # 監視開始関数
│   └── main                  # エントリーポイント
│
├── gui.py         # GUI実装
│   └── KoeMemoGUI           # GUI設定クラス
│
├── config.json    # 設定ファイル
│   ├── transcription        # 文字起こし設定
│   ├── llm                  # LLM API設定
│   ├── file_watcher         # ファイル監視設定
│   ├── prompt_templates     # プロンプトテンプレート
│   └── processed_files      # 処理済みファイル記録
│
└── koememo.log    # ログファイル
```

## パフォーマンス考慮事項

1. **文字起こし最適化**:
   - 適切なモデルサイズ選択 (tiny→large)
   - 計算タイプの最適化 (int8/float16/float32)
   - GPUアクセラレーション（利用可能な場合）

2. **非同期処理**:
   - ファイル監視とファイル処理の非同期分離
   - キューベースの処理で負荷分散

3. **リソース管理**:
   - 処理済みファイル履歴の定期的なクリーンアップ
   - エラーハンドリングによる安定性確保

## セキュリティ考慮事項

1. **API認証情報**:
   - APIキーはローカル設定ファイルに保存
   - キーの暗号化は現時点では未実装

2. **データセキュリティ**:
   - すべてのデータ処理はローカルまたはAPI経由で実行
   - ファイルデータが第三者サーバーに永続保存されることはない
   - 処理済みファイルの追跡はファイルハッシュのみ 